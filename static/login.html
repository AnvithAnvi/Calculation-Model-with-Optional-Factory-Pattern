<!doctype html>
<html>
<head>
  <meta charset="utf-8" />
  <title>Login</title>
  <style>body{font-family:Arial,Helvetica,sans-serif;margin:24px}label{display:block;margin-top:8px}input{padding:6px;width:300px}button{margin-top:12px;padding:8px 12px}#message{margin-top:12px;color:green}#error{margin-top:12px;color:red}</style>
</head>
<body>
  <h1>Login</h1>
  <form id="loginForm">
    <label>Email or Username<input id="username_or_email" type="text" required></label>
    <label>Password<input id="password" type="password" required></label>
    <button type="submit">Login</button>
  </form>
  <div id="message" role="status" aria-live="polite"></div>
  <div id="error" role="alert"></div>

  <script>
    const form = document.getElementById('loginForm');
    const username = document.getElementById('username_or_email');
    const password = document.getElementById('password');
    const message = document.getElementById('message');
    const error = document.getElementById('error');

    function showError(txt){ error.textContent = txt; message.textContent = ''; }
    function showMessage(txt){ message.textContent = txt; error.textContent = ''; }

    form.addEventListener('submit', async (e)=>{
      e.preventDefault();
      try{
        const res = await fetch('/users/login', {
          method: 'POST',
          headers: {'Content-Type':'application/json'},
          body: JSON.stringify({ username_or_email: username.value, password: password.value })
        });
        if (res.status === 200){
          const data = await res.json();
          // store JWT in localStorage
          localStorage.setItem('access_token', data.access_token);
          showMessage('Login successful. Token saved to localStorage.');
        } else if (res.status === 401){
          showError('Invalid credentials');
        } else {
          const err = await res.json();
          showError(err.detail || JSON.stringify(err));
        }
      }catch(err){ showError('Network error: '+err.message); }
    });
  </script>
</body>
</html>
